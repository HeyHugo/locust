<!DOCTYPE html> 
<html>
<head> 
    <title>Locust</title> 
    <link rel="stylesheet" type="text/css" href="/static/style.css" media="screen">
</head> 
<body>
    <div>
        <a href="#"></a>
    </div>
    <div id="content">
        <ul class="tabs">
            <li><a href="#">Run</a></li>
            <li><a href="#">Statistics</a></li>
            <li><a href="#">Failures</a></li>
        </ul>
        <div style="clear:left;"></div>
        <div class="panes">
            <div>
                <form action="/swarm" method="POST" id="swarm_form">
                    <table>
                        <tr>
                            <td>Number of users to simulate</td>
                            <td><input type="text" name="locust_count" style="width:105px;" /></td>
                        <tr>
                        <tr>
                            <td title="Number of Locust users to spawn each second">Hatch rate (users spawned/second)</td>
                            <td><input type="text" name="hatch_rate" style="width:105px;" /></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td><input type="submit" value="Start swarming"></td>
                        </tr>
                    </table>
                </form>
            </div>
            <div style="display:none;">
                <table id="stats" class="stats">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th># requests</th>
                            <th># fails</th>
                            <th>Median</th>
                            <th>Average</th>
                            <th>Min</th>
                            <th>Max</th>
                            <th title="Average Content-Length">Content-Length</th>
                            <th># reqs/sec</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <div style="margin-top:20px;">
                    <a href="/stats/requests/csv">Download request statistics CSV</a><br />
                    <a href="/stats/distribution/csv">Download response time distribution CSV</a>
                </div>
            </div>
            <div style="display:none;">
                <table id="errors" class="stats">
                    <thead>
                        <th class="error_count"># fails</th>
                        <th class="error_type">Type</th>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="/static/jquery-1.4.min.js"></script> 
    <script type="text/javascript" src="/static/jquery.jqote2.min.js"></script>
    <script type="text/javascript" src="/static/jquery.tools.min.js"></script> 
    <script type="text/x-jqote-template" id="stats-template">
        <![CDATA[
        <tr>
            <td><%= this.name %></td>
            <td><%= this.num_reqs %></td>
            <td><%= this.num_failures %></td>
            <td><%= Math.round(this.median_response_time) %></td>
            <td><%= Math.round(this.avg_response_time) %></td>
            <td><%= this.min_response_time %></td>
            <td><%= this.max_response_time %></td>
            <td><%= Math.round(this.avg_content_length) %></td>
            <td><%= Math.round(this.current_rps*100)/100 %></td>
        </tr>
        ]]>
    </script>
    <script type="text/x-jqote-template" id="errors-template">
        <![CDATA[
        <tr>
            <td><%= this[1] %></td>
            <td><%= this[0] %></td>
        </tr>
        ]]>
    </script>
    <script type="text/javascript">
        $("ul.tabs").tabs("div.panes > div");
        
        var stats_tpl = $('#stats-template');
        var errors_tpl = $('#errors-template');
        
        $('#swarm_form').submit(function(event) {
            event.preventDefault();
            $.post($(this).attr("action"), $(this).serialize());
        });
        
        function updateStats() {
            $.get('/stats/requests', function (data) {
                $('#stats tbody').empty();
                $('#errors tbody').empty();
                var report = JSON.parse(data);
                $('#stats tbody').jqoteapp(stats_tpl, report.stats);
                $('#errors tbody').jqoteapp(errors_tpl, report.errors);
                setTimeout(updateStats, 2000);
            });
        }
        updateStats();
    </script>
</body>
</html>
